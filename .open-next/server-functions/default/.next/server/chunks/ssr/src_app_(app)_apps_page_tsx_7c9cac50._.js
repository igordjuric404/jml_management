module.exports=[40646,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(30118),f=a.i(91119),g=a.i(99570),h=a.i(86304),i=a.i(6015),j=a.i(14574),k=a.i(35732),l=a.i(15055),m=a.i(96221),n=a.i(70106);let o=(0,n.default)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);var p=a.i(43108);let q=(0,n.default)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var r=a.i(21161),s=a.i(3314),t=a.i(38246),u=a.i(11619);function v(){let a=(0,d.useSearchParams)().get("client_id"),{data:n,isLoading:v}=(0,e.useOAuthApps)(),{data:w,isLoading:x}=(0,e.useAppDetail)(a??""),[y,z]=(0,c.useState)(new Set),[A,B]=(0,c.useState)(new Set),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)({}),I=(0,e.useRevokeAppForUsers)(a??""),J=(0,e.useRestoreAppForUsers)(a??""),K=(0,e.useUpdateScopes)(a??""),L=(0,e.useGlobalAppRemoval)(),M=(0,c.useMemo)(()=>w?.users?.filter(a=>"Active"===a.status)??[],[w]),N=(0,c.useMemo)(()=>w?.users?.filter(a=>"Revoked"===a.status||"Inactive"===a.status)??[],[w]),O=a=>{let b={};(a.raw_scopes??[]).forEach(a=>{b[a.split("/").pop()??a]=!0}),w?.scopes?.forEach(a=>{a in b||(b[a]=!1)}),H(b),F(a),D(!0)},P=!!a&&(x||w);return v&&!P?(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)(m.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):P&&w?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(t.default,{href:"/apps",children:(0,b.jsx)(g.Button,{variant:"outline",size:"sm",children:"Back to Apps"})}),(0,b.jsxs)(k.DropdownMenu,{children:[(0,b.jsx)(k.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(g.Button,{variant:"outline",children:(0,b.jsx)(o,{className:"h-4 w-4"})})}),(0,b.jsx)(k.DropdownMenuContent,{children:(0,b.jsxs)(k.DropdownMenuItem,{variant:"destructive",onClick:()=>{a&&w&&(0,u.confirmAction)({title:"Global App Removal",description:`Revoke this app globally for ALL users? This will revoke ${w.active_grants} grant(s). This action cannot be undone.`,confirmLabel:"Revoke All",onConfirm:()=>{L.mutate({clientId:a,appName:w.app_name})}})},disabled:L.isPending,children:[(0,b.jsx)(s.Shield,{className:"mr-2 h-4 w-4"}),"Revoke Globally"]})})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{className:"text-base",children:w.app_name}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Client ID: ",(0,b.jsx)("code",{children:w.client_id})]})]}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold",children:w.active_grants}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Active Grants"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold",children:w.revoked_grants}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Revoked"})]})]}),w.scopes&&w.scopes.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:w.scopes.map(a=>(0,b.jsx)(h.Badge,{variant:/send|modify|compose|write|admin|manage/i.test(a)?"destructive":"default",className:/send|modify|compose|write|admin|manage/i.test(a)?void 0:"bg-blue-500/90 text-white",children:a},a))})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Active Grants"}),(0,b.jsxs)(g.Button,{size:"sm",variant:"destructive",onClick:()=>{let a=Array.from(y);0!==a.length&&I.mutate(a,{onSuccess:()=>z(new Set)})},disabled:0===y.size||I.isPending,children:[I.isPending?(0,b.jsx)(m.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(p.Lock,{className:"mr-2 h-4 w-4"}),"Revoke Selected (",y.size,")"]})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{className:"w-10"}),(0,b.jsx)(i.TableHead,{children:"Email"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{children:"Risk"}),(0,b.jsx)(i.TableHead,{children:"Scopes"}),(0,b.jsx)(i.TableHead,{children:"Case"}),(0,b.jsx)(i.TableHead,{})]})}),(0,b.jsx)(i.TableBody,{children:M.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(l.Checkbox,{checked:y.has(a.artifact_name),onCheckedChange:()=>{var b;return b=a.artifact_name,void z(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})}})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(t.default,{href:`/employees?email=${encodeURIComponent(a.email)}`,className:"text-primary hover:underline",children:a.email})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(h.Badge,{variant:"default",children:a.status})}),(0,b.jsx)(i.TableCell,{children:a.risk_level?(0,b.jsx)(h.Badge,{variant:"destructive",children:a.risk_level}):"-"}),(0,b.jsx)(i.TableCell,{className:"max-w-[200px] truncate",children:a.scopes?.map(a=>a.scope).join(", ")||"-"}),(0,b.jsx)(i.TableCell,{children:a.case?(0,b.jsx)(t.default,{href:`/cases/${a.case}`,className:"text-primary hover:underline",children:a.case}):"-"}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(g.Button,{size:"sm",variant:"outline",onClick:()=>O(a),children:[(0,b.jsx)(r.Settings,{className:"mr-2 h-4 w-4"}),"Manage"]})})]},a.artifact_name))})]})})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Revoked / Inactive Grants"}),(0,b.jsxs)(g.Button,{size:"sm",variant:"outline",onClick:()=>{let a=Array.from(A);0!==a.length&&J.mutate(a,{onSuccess:()=>B(new Set)})},disabled:0===A.size||J.isPending,children:[J.isPending?(0,b.jsx)(m.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(q,{className:"mr-2 h-4 w-4"}),"Restore Selected (",A.size,")"]})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{className:"w-10"}),(0,b.jsx)(i.TableHead,{children:"Email"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{children:"Risk"}),(0,b.jsx)(i.TableHead,{children:"Scopes"}),(0,b.jsx)(i.TableHead,{children:"Case"}),(0,b.jsx)(i.TableHead,{})]})}),(0,b.jsx)(i.TableBody,{children:N.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(l.Checkbox,{checked:A.has(a.artifact_name),onCheckedChange:()=>{var b;return b=a.artifact_name,void B(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})}})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(t.default,{href:`/employees?email=${encodeURIComponent(a.email)}`,className:"text-primary hover:underline",children:a.email})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(h.Badge,{variant:"secondary",children:a.status})}),(0,b.jsx)(i.TableCell,{children:a.risk_level?(0,b.jsx)(h.Badge,{variant:"outline",children:a.risk_level}):"-"}),(0,b.jsx)(i.TableCell,{className:"max-w-[200px] truncate",children:a.scopes?.map(a=>a.scope).join(", ")||"-"}),(0,b.jsx)(i.TableCell,{children:a.case?(0,b.jsx)(t.default,{href:`/cases/${a.case}`,className:"text-primary hover:underline",children:a.case}):"-"}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(g.Button,{size:"sm",variant:"outline",onClick:()=>O(a),children:[(0,b.jsx)(r.Settings,{className:"mr-2 h-4 w-4"}),"Manage"]})})]},a.artifact_name))})]})})]}),(0,b.jsx)(j.Dialog,{open:C,onOpenChange:D,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-lg",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Manage Scopes"})}),(0,b.jsxs)("div",{className:"space-y-4 py-4 max-h-[60vh] overflow-y-auto",children:[E&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[E.email," â€” ",E.artifact_name]}),(0,b.jsx)("div",{className:"space-y-2",children:w?.scopes?.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Checkbox,{id:`scope-${a}`,checked:G[a]??!1,onCheckedChange:b=>H(c=>({...c,[a]:!!b}))}),(0,b.jsx)("label",{htmlFor:`scope-${a}`,className:"text-sm cursor-pointer",children:a})]},a))})]}),(0,b.jsxs)(j.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),(0,b.jsx)(g.Button,{onClick:()=>{if(!E)return;let a=Object.entries(G).filter(([,a])=>a).map(([a])=>a.startsWith("https://")?a:`https://www.googleapis.com/auth/${a}`);K.mutate({artifactName:E.artifact_name,scopes:a},{onSuccess:()=>{D(!1),F(null)}})},disabled:K.isPending,children:K.isPending?(0,b.jsx)(m.Loader2,{className:"h-4 w-4 animate-spin"}):"Save"})]})]})})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"OAuth App Dashboard"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Manage OAuth app grants and permissions"})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-base",children:"OAuth Apps"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"App"}),(0,b.jsx)(i.TableHead,{children:"Client ID"}),(0,b.jsx)(i.TableHead,{children:"Active Grants"}),(0,b.jsx)(i.TableHead,{children:"Users"}),(0,b.jsx)(i.TableHead,{children:"Cases"})]})}),(0,b.jsx)(i.TableBody,{children:n?.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"font-medium",children:(0,b.jsx)(t.default,{href:`/apps?client_id=${encodeURIComponent(a.client_id)}`,className:"text-primary hover:underline",children:a.app_display_name||"Unknown"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)("code",{className:"text-xs",children:a.client_id})}),(0,b.jsx)(i.TableCell,{children:a.grant_count}),(0,b.jsx)(i.TableCell,{children:a.user_count??"-"}),(0,b.jsx)(i.TableCell,{children:a.case_count??"-"})]},a.client_id))})]})})]})]})}function w(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)(m.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}),children:(0,b.jsx)(v,{})})}a.s(["default",()=>w],40646)}];

//# sourceMappingURL=src_app_%28app%29_apps_page_tsx_7c9cac50._.js.map