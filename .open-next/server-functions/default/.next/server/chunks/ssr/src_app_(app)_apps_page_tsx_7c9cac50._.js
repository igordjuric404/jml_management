module.exports=[40646,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(30118),f=a.i(91119),g=a.i(99570),h=a.i(86304),i=a.i(6015),j=a.i(14574),k=a.i(35732),l=a.i(15055),m=a.i(96221),n=a.i(70106);let o=(0,n.default)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);var p=a.i(43108);let q=(0,n.default)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var r=a.i(21161),s=a.i(3314),t=a.i(38246);function u(){let a=(0,d.useSearchParams)().get("client_id"),{data:n,isLoading:u}=(0,e.useOAuthApps)(),{data:v,isLoading:w}=(0,e.useAppDetail)(a??""),[x,y]=(0,c.useState)(new Set),[z,A]=(0,c.useState)(new Set),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)({}),H=(0,e.useRevokeAppForUsers)(a??""),I=(0,e.useRestoreAppForUsers)(a??""),J=(0,e.useUpdateScopes)(a??""),K=(0,e.useGlobalAppRemoval)(),L=(0,c.useMemo)(()=>v?.users?.filter(a=>"Active"===a.status)??[],[v]),M=(0,c.useMemo)(()=>v?.users?.filter(a=>"Revoked"===a.status||"Inactive"===a.status)??[],[v]),N=a=>{let b={};(a.raw_scopes??[]).forEach(a=>{b[a.split("/").pop()??a]=!0}),v?.scopes?.forEach(a=>{a in b||(b[a]=!1)}),G(b),E(a),C(!0)},O=!!a&&(w||v);return u&&!O?(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)(m.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):O&&v?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(t.default,{href:"/apps",children:(0,b.jsx)(g.Button,{variant:"outline",size:"sm",children:"Back to Apps"})}),(0,b.jsxs)(k.DropdownMenu,{children:[(0,b.jsx)(k.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(g.Button,{variant:"outline",children:(0,b.jsx)(o,{className:"h-4 w-4"})})}),(0,b.jsx)(k.DropdownMenuContent,{children:(0,b.jsxs)(k.DropdownMenuItem,{variant:"destructive",onClick:()=>{a&&v&&confirm(`Revoke this app globally for ALL users? This will revoke ${v.active_grants} grant(s).`)&&K.mutate({clientId:a,appName:v.app_name})},disabled:K.isPending,children:[(0,b.jsx)(s.Shield,{className:"mr-2 h-4 w-4"}),"Revoke Globally"]})})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{className:"text-base",children:v.app_name}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Client ID: ",(0,b.jsx)("code",{children:v.client_id})]})]}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold",children:v.active_grants}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Active Grants"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold",children:v.revoked_grants}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Revoked"})]})]}),v.scopes&&v.scopes.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:v.scopes.map(a=>(0,b.jsx)(h.Badge,{variant:/send|modify|compose|write|admin|manage/i.test(a)?"destructive":"default",className:/send|modify|compose|write|admin|manage/i.test(a)?void 0:"bg-blue-500/90 text-white",children:a},a))})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Active Grants"}),(0,b.jsxs)(g.Button,{size:"sm",variant:"destructive",onClick:()=>{let a=Array.from(x);0!==a.length&&H.mutate(a,{onSuccess:()=>y(new Set)})},disabled:0===x.size||H.isPending,children:[H.isPending?(0,b.jsx)(m.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(p.Lock,{className:"mr-2 h-4 w-4"}),"Revoke Selected (",x.size,")"]})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{className:"w-10"}),(0,b.jsx)(i.TableHead,{children:"Email"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{children:"Risk"}),(0,b.jsx)(i.TableHead,{children:"Scopes"}),(0,b.jsx)(i.TableHead,{children:"Case"}),(0,b.jsx)(i.TableHead,{})]})}),(0,b.jsx)(i.TableBody,{children:L.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(l.Checkbox,{checked:x.has(a.artifact_name),onCheckedChange:()=>{var b;return b=a.artifact_name,void y(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})}})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(t.default,{href:`/employees?email=${encodeURIComponent(a.email)}`,className:"text-primary hover:underline",children:a.email})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(h.Badge,{variant:"default",children:a.status})}),(0,b.jsx)(i.TableCell,{children:a.risk_level?(0,b.jsx)(h.Badge,{variant:"destructive",children:a.risk_level}):"-"}),(0,b.jsx)(i.TableCell,{className:"max-w-[200px] truncate",children:a.scopes?.map(a=>a.scope).join(", ")||"-"}),(0,b.jsx)(i.TableCell,{children:a.case?(0,b.jsx)(t.default,{href:`/cases/${a.case}`,className:"text-primary hover:underline",children:a.case}):"-"}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(g.Button,{size:"sm",variant:"outline",onClick:()=>N(a),children:[(0,b.jsx)(r.Settings,{className:"mr-2 h-4 w-4"}),"Manage"]})})]},a.artifact_name))})]})})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Revoked / Inactive Grants"}),(0,b.jsxs)(g.Button,{size:"sm",variant:"outline",onClick:()=>{let a=Array.from(z);0!==a.length&&I.mutate(a,{onSuccess:()=>A(new Set)})},disabled:0===z.size||I.isPending,children:[I.isPending?(0,b.jsx)(m.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(q,{className:"mr-2 h-4 w-4"}),"Restore Selected (",z.size,")"]})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{className:"w-10"}),(0,b.jsx)(i.TableHead,{children:"Email"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{children:"Risk"}),(0,b.jsx)(i.TableHead,{children:"Scopes"}),(0,b.jsx)(i.TableHead,{children:"Case"}),(0,b.jsx)(i.TableHead,{})]})}),(0,b.jsx)(i.TableBody,{children:M.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(l.Checkbox,{checked:z.has(a.artifact_name),onCheckedChange:()=>{var b;return b=a.artifact_name,void A(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})}})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(t.default,{href:`/employees?email=${encodeURIComponent(a.email)}`,className:"text-primary hover:underline",children:a.email})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(h.Badge,{variant:"secondary",children:a.status})}),(0,b.jsx)(i.TableCell,{children:a.risk_level?(0,b.jsx)(h.Badge,{variant:"outline",children:a.risk_level}):"-"}),(0,b.jsx)(i.TableCell,{className:"max-w-[200px] truncate",children:a.scopes?.map(a=>a.scope).join(", ")||"-"}),(0,b.jsx)(i.TableCell,{children:a.case?(0,b.jsx)(t.default,{href:`/cases/${a.case}`,className:"text-primary hover:underline",children:a.case}):"-"}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(g.Button,{size:"sm",variant:"outline",onClick:()=>N(a),children:[(0,b.jsx)(r.Settings,{className:"mr-2 h-4 w-4"}),"Manage"]})})]},a.artifact_name))})]})})]}),(0,b.jsx)(j.Dialog,{open:B,onOpenChange:C,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-lg",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Manage Scopes"})}),(0,b.jsxs)("div",{className:"space-y-4 py-4 max-h-[60vh] overflow-y-auto",children:[D&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[D.email," â€” ",D.artifact_name]}),(0,b.jsx)("div",{className:"space-y-2",children:v?.scopes?.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Checkbox,{id:`scope-${a}`,checked:F[a]??!1,onCheckedChange:b=>G(c=>({...c,[a]:!!b}))}),(0,b.jsx)("label",{htmlFor:`scope-${a}`,className:"text-sm cursor-pointer",children:a})]},a))})]}),(0,b.jsxs)(j.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),(0,b.jsx)(g.Button,{onClick:()=>{if(!D)return;let a=Object.entries(F).filter(([,a])=>a).map(([a])=>a.startsWith("https://")?a:`https://www.googleapis.com/auth/${a}`);J.mutate({artifactName:D.artifact_name,scopes:a},{onSuccess:()=>{C(!1),E(null)}})},disabled:J.isPending,children:J.isPending?(0,b.jsx)(m.Loader2,{className:"h-4 w-4 animate-spin"}):"Save"})]})]})})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"OAuth App Dashboard"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Manage OAuth app grants and permissions"})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-base",children:"OAuth Apps"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"App"}),(0,b.jsx)(i.TableHead,{children:"Client ID"}),(0,b.jsx)(i.TableHead,{children:"Active Grants"}),(0,b.jsx)(i.TableHead,{children:"Users"}),(0,b.jsx)(i.TableHead,{children:"Cases"})]})}),(0,b.jsx)(i.TableBody,{children:n?.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"font-medium",children:(0,b.jsx)(t.default,{href:`/apps?client_id=${encodeURIComponent(a.client_id)}`,className:"text-primary hover:underline",children:a.app_display_name||"Unknown"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)("code",{className:"text-xs",children:a.client_id})}),(0,b.jsx)(i.TableCell,{children:a.grant_count}),(0,b.jsx)(i.TableCell,{children:a.user_count??"-"}),(0,b.jsx)(i.TableCell,{children:a.case_count??"-"})]},a.client_id))})]})})]})]})}function v(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)(m.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}),children:(0,b.jsx)(u,{})})}a.s(["default",()=>v],40646)}];

//# sourceMappingURL=src_app_%28app%29_apps_page_tsx_7c9cac50._.js.map